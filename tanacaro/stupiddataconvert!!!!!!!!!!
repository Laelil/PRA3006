<!DOCTYPE html>
<html>

<head>
    <title>Example</title>
    <!-- Initialize a global WBK function -->
    <script src="https://cdn.rawgit.com/maxlath/wikidata-sdk/dist/dist/wikibase-sdk.min.js"></script>
    <!-- Initialize a global wdk object using the WBK object -->
    <script src="https://cdn.rawgit.com/maxlath/wikidata-sdk/dist/dist/wikidata-sdk.min.js"></script>
</head>

<body>
<pre id="output"></pre>

<h2>Convert a string into a date object.</h2>

<p id="demo"></p>

<script>
query = `#PTSDhome (the working version)

SELECT DISTINCT ?drugClassLabel
(GROUP_CONCAT(DISTINCT ?drugLabel;separator=", ") as ?drug)
{
  wd:Q202387 wdt:P2176 ?drug;

SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".
    ?drug rdfs:label ?drugLabel.
    ?drugClass rdfs:label ?drugClassLabel.

                        }
OPTIONAL { ?drug wdt:P279 ?drugClass. }
  }

GROUP BY  ?drugClassLabel
ORDER BY DESC(?drugClass)
`;
    const url = wdk.sparqlQuery(query)
    async function main () {
      const response = await fetch(url)
      const results = await response.json()
      var resultsSimple = await wdk.simplify.sparqlResults(results)

        document.getElementById('output').innerHTML =  results.length;
const resultsMapped = resultsSimple.map((result) => ({"name": result.drug.classLabel, "children": result.drug.value.split(",").map((drug)=>({name: drug, children: []}))}))
    console.log(resultsMapped)

        document.getElementById('output').innerHTML += JSON.stringify(resultsMapped);


    return resultsSimple
    }
    results = main()


</script>

</body>
</html>
